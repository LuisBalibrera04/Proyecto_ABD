-- Inserciones para la tabla RESERVA (15,000 registros)
-- La fecha_reserva debe ser máximo 1 mes antes de fecha_clase
-- id_socio: 1 a 300
-- id_clase: 1 a 50

-- Primeros 100 registros explícitos para variedad
INSERT INTO RESERVA (fecha_reserva, fecha_clase, id_socio, id_clase) VALUES
('2024-10-15', '2024-11-10', 1, 1),
('2024-10-16', '2024-11-11', 2, 2),
('2024-10-17', '2024-11-12', 3, 3),
('2024-10-18', '2024-11-13', 4, 4),
('2024-10-19', '2024-11-14', 5, 5),
('2024-10-20', '2024-11-15', 6, 6),
('2024-10-21', '2024-11-16', 7, 7),
('2024-10-22', '2024-11-17', 8, 8),
('2024-10-23', '2024-11-18', 9, 9),
('2024-10-24', '2024-11-19', 10, 10),
('2024-10-25', '2024-11-20', 11, 11),
('2024-10-26', '2024-11-21', 12, 12),
('2024-10-27', '2024-11-22', 13, 13),
('2024-10-28', '2024-11-23', 14, 14),
('2024-10-29', '2024-11-24', 15, 15),
('2024-10-30', '2024-11-25', 16, 16),
('2024-10-31', '2024-11-26', 17, 17),
('2024-11-01', '2024-11-27', 18, 18),
('2024-11-02', '2024-11-28', 19, 19),
('2024-11-03', '2024-11-29', 20, 20),
('2024-11-04', '2024-11-30', 21, 21),
('2024-11-05', '2024-12-01', 22, 22),
('2024-11-06', '2024-12-02', 23, 23),
('2024-11-07', '2024-12-03', 24, 24),
('2024-11-08', '2024-12-04', 25, 25),
('2024-11-09', '2024-12-05', 26, 26),
('2024-11-10', '2024-12-06', 27, 27),
('2024-10-12', '2024-11-08', 28, 28),
('2024-10-13', '2024-11-09', 29, 29),
('2024-10-14', '2024-11-10', 30, 30),
('2024-10-15', '2024-11-11', 31, 31),
('2024-10-16', '2024-11-12', 32, 32),
('2024-10-17', '2024-11-13', 33, 33),
('2024-10-18', '2024-11-14', 34, 34),
('2024-10-19', '2024-11-15', 35, 35),
('2024-10-20', '2024-11-16', 36, 36),
('2024-10-21', '2024-11-17', 37, 37),
('2024-10-22', '2024-11-18', 38, 38),
('2024-10-23', '2024-11-19', 39, 39),
('2024-10-24', '2024-11-20', 40, 40),
('2024-10-25', '2024-11-21', 41, 41),
('2024-10-26', '2024-11-22', 42, 42),
('2024-10-27', '2024-11-23', 43, 43),
('2024-10-28', '2024-11-24', 44, 44),
('2024-10-29', '2024-11-25', 45, 45),
('2024-10-30', '2024-11-26', 46, 46),
('2024-10-31', '2024-11-27', 47, 47),
('2024-11-01', '2024-11-28', 48, 48),
('2024-11-02', '2024-11-29', 49, 49),
('2024-11-03', '2024-11-30', 50, 50),
('2024-09-15', '2024-10-10', 51, 1),
('2024-09-16', '2024-10-11', 52, 2),
('2024-09-17', '2024-10-12', 53, 3),
('2024-09-18', '2024-10-13', 54, 4),
('2024-09-19', '2024-10-14', 55, 5),
('2024-09-20', '2024-10-15', 56, 6),
('2024-09-21', '2024-10-16', 57, 7),
('2024-09-22', '2024-10-17', 58, 8),
('2024-09-23', '2024-10-18', 59, 9),
('2024-09-24', '2024-10-19', 60, 10),
('2024-09-25', '2024-10-20', 61, 11),
('2024-09-26', '2024-10-21', 62, 12),
('2024-09-27', '2024-10-22', 63, 13),
('2024-09-28', '2024-10-23', 64, 14),
('2024-09-29', '2024-10-24', 65, 15),
('2024-09-30', '2024-10-25', 66, 16),
('2024-10-01', '2024-10-26', 67, 17),
('2024-10-02', '2024-10-27', 68, 18),
('2024-10-03', '2024-10-28', 69, 19),
('2024-10-04', '2024-10-29', 70, 20),
('2024-10-05', '2024-10-30', 71, 21),
('2024-10-06', '2024-10-31', 72, 22),
('2024-10-07', '2024-11-01', 73, 23),
('2024-10-08', '2024-11-02', 74, 24),
('2024-10-09', '2024-11-03', 75, 25),
('2024-10-10', '2024-11-04', 76, 26),
('2024-10-11', '2024-11-05', 77, 27),
('2024-10-12', '2024-11-06', 78, 28),
('2024-10-13', '2024-11-07', 79, 29),
('2024-10-14', '2024-11-08', 80, 30),
('2024-10-15', '2024-11-09', 81, 31),
('2024-10-16', '2024-11-10', 82, 32),
('2024-10-17', '2024-11-11', 83, 33),
('2024-10-18', '2024-11-12', 84, 34),
('2024-10-19', '2024-11-13', 85, 35),
('2024-10-20', '2024-11-14', 86, 36),
('2024-10-21', '2024-11-15', 87, 37),
('2024-10-22', '2024-11-16', 88, 38),
('2024-10-23', '2024-11-17', 89, 39),
('2024-10-24', '2024-11-18', 90, 40),
('2024-10-25', '2024-11-19', 91, 41),
('2024-10-26', '2024-11-20', 92, 42),
('2024-10-27', '2024-11-21', 93, 43),
('2024-10-28', '2024-11-22', 94, 44),
('2024-10-29', '2024-11-23', 95, 45),
('2024-10-30', '2024-11-24', 96, 46),
('2024-10-31', '2024-11-25', 97, 47),
('2024-11-01', '2024-11-26', 98, 48),
('2024-11-02', '2024-11-27', 99, 49),
('2024-11-03', '2024-11-28', 100, 50);

-- Generar los restantes 14,900 registros de manera eficiente
-- Asegurando que fecha_reserva sea máximo 30 días antes de fecha_clase
DECLARE @counter INT = 101;
DECLARE @max_records INT = 15000;
DECLARE @fecha_clase DATE;
DECLARE @fecha_reserva DATE;
DECLARE @id_socio INT;
DECLARE @id_clase INT;
DECLARE @dias_anticipacion INT;

WHILE @counter <= @max_records
BEGIN
    -- Generar fecha_clase en un rango de 12 meses
    SET @fecha_clase = DATEADD(DAY, (@counter % 365), '2024-01-01');
    
    -- Generar días de anticipación (entre 1 y 30 días antes)
    SET @dias_anticipacion = ((@counter * 7) % 30) + 1;
    
    -- Calcular fecha_reserva
    SET @fecha_reserva = DATEADD(DAY, -@dias_anticipacion, @fecha_clase);
    
    -- Generar id_socio (ciclar entre 1 y 300)
    SET @id_socio = ((@counter - 1) % 300) + 1;
    
    -- Generar id_clase (ciclar entre 1 y 50)
    SET @id_clase = ((@counter - 1) % 50) + 1;
    
    -- Insertar solo si no existe la combinación
    IF NOT EXISTS (SELECT 1 FROM RESERVA WHERE id_socio = @id_socio AND id_clase = @id_clase AND fecha_clase = @fecha_clase)
    BEGIN
        INSERT INTO RESERVA (fecha_reserva, fecha_clase, id_socio, id_clase)
        VALUES (@fecha_reserva, @fecha_clase, @id_socio, @id_clase);
    END
    
    SET @counter = @counter + 1;
END;

-- Método alternativo usando CTE para generación masiva más eficiente
;WITH Numbers AS (
    SELECT TOP 14900 ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) + 100 AS num
    FROM sys.all_objects a1
    CROSS JOIN sys.all_objects a2
)
INSERT INTO RESERVA (fecha_reserva, fecha_clase, id_socio, id_clase)
SELECT 
    DATEADD(DAY, -((num * 7) % 30 + 1), DATEADD(DAY, (num % 365), '2024-01-01')) AS fecha_reserva,
    DATEADD(DAY, (num % 365), '2024-01-01') AS fecha_clase,
    ((num - 1) % 300) + 1 AS id_socio,
    ((num - 1) % 50) + 1 AS id_clase
FROM Numbers
WHERE NOT EXISTS (
    SELECT 1 FROM RESERVA r 
    WHERE r.id_socio = ((num - 1) % 300) + 1 
    AND r.id_clase = ((num - 1) % 50) + 1 
    AND r.fecha_clase = DATEADD(DAY, (num % 365), '2024-01-01')
);
